<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient Management System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: rgb(2,46,135);
      color: white;
      padding: 20px;
      text-align: center;
    }

    h1 {
      margin: 0;
    }

    .button-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 10px;
      background-color: #f2f2f2;
    }

    .add-button {
      background-color:green;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      margin-right: 10px;
      cursor: pointer;
      font-size: 16px;
    }

    .add-button:hover {
      background-color: #45a049;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
      background-color: #fefefe;
      margin: 10% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      border-radius: 5px;
    }

    .modal-content input[type="text"],
    .modal-content input[type="email"],
    .modal-content input[type="date"],
    .modal-content select,
    .modal-content textarea {
      width: calc(100% - 20px);
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .modal-content input[type="submit"] {
      background-color: #4CAF50;
      color: white;
      padding: 14px 20px;
      margin: 8px 0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
    }

    .modal-content input[type="submit"]:hover {
      background-color: #45a049;
    }

    #patientsTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    #patientsTable th, #patientsTable td {
      border: 1px solid #ddd;
      padding: 8px;
    }

    #patientsTable th {
      background-color: #f2f2f2;
    }

    .operations a {
      text-decoration: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }

    .update { background-color: #2ecc71; }
    .delete { background-color: #e74c3c; }

    /* Search bar styles */
    .search-container {
      flex: 1;
      text-align: right;
    }

    .search-container input[type=text] {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .search-container button {
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    .search-container button:hover {
      background-color: #2980b9;
    }
  </style>
</head>
<body>

<header>
  <h1>Patient Details</h1>
</header>

<div class="button-container">
  <button class="add-button" onclick="openModal()">Add Patient</button>
  <div class="search-container">
    <input type="text" placeholder="Search.." name="searchPatient">
    <button type="submit">Search</button>
  </div>
</div>

<div id="myModal" class="modal">
  <div class="modal-content">
    <form id="addPatientForm" method="post" action="#">
      <label for="patientId">Patient ID:</label><br>
      <input type="text" id="patientId" name="patientId" required><br>

      <label for="name">Name:</label><br>
      <input type="text" id="name" name="name" required><br>

      <label for="email">Email:</label><br>
      <input type="email" id="email" name="email" required><br>

      <label for="dob">Date of Birth:</label><br>
      <input type="date" id="dob" name="dob" required><br>

      <label for="address">Address:</label><br>
      <textarea id="address" name="address" rows="4" required></textarea><br>

      <label for="phone">Phone Number:</label><br>
      <input type="text" id="phone" name="phone" required><br>

      <input type="submit" value="Submit">
    </form>
  </div>
</div>

<table id="patientsTable">
  <thead>
    <tr>
      <th>Patient ID</th>
      <th>Name</th>
      <th>Email</th>
      <th>Date of Birth</th>
      <th>Address</th>
      <th>Phone Number</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="patientsTableBody"></tbody>
</table>

<script>
function updatePatient(row) {
  var cells = row.getElementsByTagName("td");
  var patientId = cells[0].innerText;
  var name = cells[1].innerText;
  var email = cells[2].innerText;
  var dob = cells[3].innerText;
  var address = cells[4].innerText;
  var phone = cells[5].innerText;

  // Populate the form fields with existing data
  document.getElementById("patientId").value = patientId;
  document.getElementById("name").value = name;
  document.getElementById("email").value = email;
  document.getElementById("dob").value = dob;
  document.getElementById("address").value = address;
  document.getElementById("phone").value = phone;

  // Store the reference to the row being updated
  document.getElementById("addPatientForm").setAttribute("data-row-index", row.rowIndex);

  // Change the form action to indicate update mode
  document.getElementById("addPatientForm").setAttribute("data-mode", "update");

  // Open the modal for updating
  openModal();
}

// Function to handle form submission for adding or updating a patient
document.getElementById("addPatientForm").onsubmit = function(event) {
  event.preventDefault(); // Prevent the form from submitting normally

  // Get form data
  var patientId = document.getElementById("patientId").value;
  var name = document.getElementById("name").value;
  var email = document.getElementById("email").value;
  var dob = document.getElementById("dob").value;
  var address = document.getElementById("address").value;
  var phone = document.getElementById("phone").value;

  // Determine the mode (add or update)
  var mode = this.getAttribute("data-mode");

  // Get the index of the row being updated
  var rowIndex = parseInt(this.getAttribute("data-row-index"));

  // Handle adding or updating based on the mode
  if (mode === "update" && rowIndex >= 0) {
    // Update mode: Update the existing row with the new data
    var row = document.getElementById("patientsTable").rows[rowIndex];
    row.cells[0].innerText = patientId;
    row.cells[1].innerText = name;
    row.cells[2].innerText = email;
    row.cells[3].innerText = dob;
    row.cells[4].innerText = address;
    row.cells[5].innerText = phone;

    // Update data in local storage
    updateLocalStorage(patientId, name, email, dob, address, phone, rowIndex);
  } else {
    // Add mode: Create a new row with the submitted data
    var newRow = document.getElementById("patientsTableBody").insertRow();
    newRow.innerHTML = "<td>" + patientId + "</td><td>" + name + "</td><td>" + email + "</td><td>" + dob + "</td><td>" + address + "</td><td>" + phone + "</td><td class='operations'><a class='update' href='#' onclick='updatePatient(this.parentNode.parentNode)'>Update</a><a class='delete' href='#' onclick='deleteRow(this.parentNode.parentNode)'>Delete</a></td>";

    // Save data to local storage
    saveToLocalStorage(patientId, name, email, dob, address, phone);
  }

  closeModal();

  // Save data to the database
  saveToDatabase(patientId, name, email, dob, address, phone);
};

// Function to save patient details to local storage
function saveToLocalStorage(patientId, name, email, dob, address, phone) {
  var patients = JSON.parse(localStorage.getItem("patients")) || [];
  patients.push({ patientId: patientId, name: name, email: email, dob: dob, address: address, phone: phone });
  localStorage.setItem("patients", JSON.stringify(patients));
}

function updateLocalStorage(patientId, name, email, dob, address, phone, rowIndex) {
  var patients = JSON.parse(localStorage.getItem("patients")) || [];
  patients[rowIndex] = { patientId: patientId, name: name, email: email, dob: dob, address: address, phone: phone };
  localStorage.setItem("patients", JSON.stringify(patients));
}

window.onload = function() {
  loadPatientsFromLocalStorage();
};

function loadPatientsFromLocalStorage() {
  var patients = JSON.parse(localStorage.getItem("patients")) || [];
  var tableBody = document.getElementById("patientsTableBody");
  patients.forEach(function(patient) {
    var row = tableBody.insertRow();
    row.innerHTML = "<td>" + patient.patientId + "</td><td>" + patient.name + "</td><td>" + patient.email + "</td><td>" + patient.dob + "</td><td>" + patient.address + "</td><td>" + patient.phone + "</td><td class='operations'><a class='update' href='#' onclick='updatePatient(this.parentNode.parentNode)'>Update</a><a class='delete' href='#' onclick='deleteRow(this.parentNode.parentNode)'>Delete</a></td>";
  });
}

function openModal() {
  document.getElementById("myModal").style.display = "block";
}

function closeModal() {
  document.getElementById("myModal").style.display = "none";
}

function deleteRow(row) {
  var rowIndex = row.rowIndex - 1; 
  row.parentNode.removeChild(row);
  removeFromLocalStorage(rowIndex);
}

function removeFromLocalStorage(rowIndex) {
  var patients = JSON.parse(localStorage.getItem("patients")) || [];
  patients.splice(rowIndex, 1);
  localStorage.setItem("patients", JSON.stringify(patients));
}

function saveToDatabase(patientId, name, email, dob, address, phone) {
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
    if (xhr.readyState === XMLHttpRequest.DONE) {
      console.log(xhr.responseText);
    }
  };
  xhr.open("POST", "save_patient_data.php", true);
  xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  xhr.send("patientId=" + patientId + "&name=" + name + "&email=" + email + "&dob=" + dob + "&address=" + address + "&phone=" + phone);
}
document.querySelector('.search-container button').addEventListener('click', function() {
  var searchText = document.querySelector('.search-container input').value.toLowerCase();
  var tableRows = document.querySelectorAll('#patientsTableBody tr');

  tableRows.forEach(function(row) {
    var patientId = row.cells[0].innerText.toLowerCase();
    var name = row.cells[1].innerText.toLowerCase();
    if (patientId.includes(searchText) || name.includes(searchText)) {
      row.style.display = 'table-row';
    } else {
      row.style.display = 'none';
    }
  });
});


</script>

</body>
</html>
